import{kytkeNappaimienKuuntelija}from"../controller/main.js";import{Cykupuu as Cyk}from"../controller/cykupuu.js";import*as Util from"../etc/util.js";function htmlToNode(t){const e=document.createElement("template");e.innerHTML=t;const i=e.content.childNodes.length;if(1!==i)throw new Error(`html parameter must represent a single node; got ${i}. Note that leading or trailing spaces around an element in your HTML, like " <img/> ", get parsed as text nodes neighbouring the element; call .trim() on your input to avoid this.`);return e.content.firstChild}class ElementAry{underlyingElement;#t;#e;#i;#n;constructor(t,e,i){if(!i)throw Error("Konstruktorille pitää antaa containingElement mihin kiinnittyä.");this.underlyingElement=null,this.#t=t,this.#e=e,this.#i=i,this.#n=!1}_isBeingAnimated(){return!!this.#n}_attach(t){this._isBeingAnimated()||(this.#n=!0,this.underlyingElement=htmlToNode(t),this.#i.appendChild(this.underlyingElement),this.#t&&this.underlyingElement.addEventListener(this.#e,this.#t),this.underlyingElement.classList.add("komponentti"),this.underlyingElement.classList.add("olemassa"),(async()=>{Util.isDebugLog()&&Util.logDebug(`${(new Date).toISOString()}: odotetaan hetki, sitten todetaan animoinnin loppuneen`),await Util.sleep(Cyk.ANIMAATIO_PITUUS_SYNTYMA),this.#n=!1,Util.isDebugLog()&&Util.logDebug(`${(new Date).toISOString()}: animointi on loppunut`)})())}#s(){this._isBeingAnimated()||(this.#n=!0,this.underlyingElement.classList.remove("olemassa"),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_KUOLEMA),this.#l()})())}#l(){Util.isDebugLog&&Util.logDebug(`removeInstantly kutsuttiin elementille ${this.underlyingElement} joka oli sisällä elementin ${this.#i}`),this.#n=!1,this.#t&&this.underlyingElement.removeEventListener(this.#e,this.#t),this.#i.removeChild(this.underlyingElement),this.underlyingElement.remove(),this.underlyingElement=null}isUp(){return!!this.underlyingElement}up(){throw Error("Määrittele minut!")}down(t=!1){if(this.isUp()){if(t)return this._downSupplement(!0),void this.#l();this._downSupplement(),this.#s()}}_downSupplement(t=!1){}}class InputHakuKentta extends ElementAry{up(){if(this.isUp())return void this.underlyingElement.focus();this._attach('<input id="hakukentta" placeholder="Hae henkilöä nimeltä" autocomplete=off name=haku/>'),this.underlyingElement.focus(),kytkeNappaimienKuuntelija(!1)}_downSupplement(){kytkeNappaimienKuuntelija(!0)}sheikkaa(){this.underlyingElement.classList.add("sheikkaa"),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_SYNTYMA),this.underlyingElement.classList.remove("sheikkaa")})()}}class ButtPainike extends ElementAry{static nro=1;#a;#r;constructor(t,e,i,n,s=null){super(e,i,n),this.#a=t,this.#r=s}up(){if(this.isUp())return;const t=`<button type="button" id="${this.#r?this.#r:"buttPainike"+ButtPainike.nro++}">${this.#a}</button>`;this._attach(t)}click(){this.isUp()&&(this.underlyingElement.classList.add("painettu"),this.underlyingElement.click(),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_SYNTYMA/2),this.underlyingElement?this.underlyingElement.classList.remove("painettu"):Util.logWarn("Alla oleva underlyingElement puuttuu, toivottavasti siksi että komponentti on jo poistettu.")})())}}class OnOffPainike extends ElementAry{static nro=1;#a;id;#o;#d;constructor(t,e,i,n,s,l=!0,a=!1){super(e,i,n),this.id=s,this.#a=t,this.#d=a,this.#o=l;const r=`<button id="${s}" type="button" ${this.#o?"disabled":""}>${this.#a}</button>`;this._attach(r),this.setPressed(this.#d)}enable(){this.underlyingElement.removeAttribute("disabled"),this.#o=!1}disable(){this.underlyingElement.setAttribute("disabled",""),this.#o=!0}#u(){let t=this.#o?"ei-voi-painaa":"painettu";this.underlyingElement.classList.add(t),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_SYNTYMA/2),this.underlyingElement.classList.remove(t)})()}click(){this.isUp()&&(this.#u(),this.underlyingElement.click())}press(){this.#o?this.#u():this.underlyingElement.click()}setPressed(t){this.#d=t,this.#d?(this.underlyingElement.classList.add("pohjaanpainettu"),this.underlyingElement.classList.remove("pohjaanpainamaton")):(this.underlyingElement.classList.remove("pohjaanpainettu"),this.underlyingElement.classList.add("pohjaanpainamaton"))}}export{htmlToNode,InputHakuKentta,ButtPainike,OnOffPainike};