import{htmlToNode}from"./komponentit.js";import{kytkeNappaimienKuuntelija,kytkeForminNappaimienKuuntelija,kytkeHakukentanKuuntelija,cykupuu}from"../controller/main.js";import{Cykupuu as Cyk}from"../controller/cykupuu.js";import*as Util from"../etc/util.js";import{Asetukset}from"../etc/asetukset.js";class InputKentta{underlyingElement;#t;#e;static nro=1;constructor(t,e){if(!t)throw Error("Konstruktorille pit√§√§ antaa j√§rkev√§t kent√§t.");this.underlyingElement=null,this.#e=e,this.#t=t}up(t,e=!1){let i;i=e?`<textarea   id="kentta${InputKentta.nro++}" autocomplete=off\n                                class="${this.#e}" maxlength="4096" rows=9 cols=45/>`:`<input      id="kentta${InputKentta.nro++}" autocomplete=off\n                                class="${this.#e}" type="text"/>`,this.underlyingElement=htmlToNode(i),this.underlyingElement.value=t,this.#t.appendChild(this.underlyingElement)}getValue(){return""+this.underlyingElement.value}down(){this.underlyingElement&&(this.#t.removeChild(this.underlyingElement),this.underlyingElement.remove(),this.underlyingElement=null)}}class InputPvm{underlyingElement;#t;#e;static nro=1;constructor(t,e){if(!t)throw Error("Konstruktorille pit√§√§ antaa j√§rkev√§t kent√§t.");this.underlyingElement=null,this.#t=t,this.#e=e}up(t){const e=`<input    id="kentta${InputKentta.nro++}" class="${this.#e}"\n                                value="${t}" type="date"/>`;this.underlyingElement=htmlToNode(e),this.#t.appendChild(this.underlyingElement)}getValue(){return this.underlyingElement.value?new Date(this.underlyingElement.value):null}down(){this.underlyingElement&&(this.#t.removeChild(this.underlyingElement),this.underlyingElement.remove(),this.underlyingElement=null)}}class InputValitsin{underlyingElement;#i;#t;static nro=1;constructor(t){if(!t)throw Error("Konstruktorille pit√§√§ antaa j√§rkev√§t kent√§t.");this.underlyingElement=null,this.#i=null,this.#t=t}up(t,e=!1){const i=t?"checked":"",n=e?"autofocus":"";this.#i=htmlToNode('<span class="forminValitsin"/>'),this.underlyingElement=htmlToNode(`<input autocomplete=off id="kentta${InputKentta.nro++}" type="checkbox" ${i} ${n}/>`),this.#i.insertAdjacentElement("afterbegin",this.underlyingElement);const a=htmlToNode('<span class="liukuja"/>');this.underlyingElement.insertAdjacentElement("afterend",a),this.#t.appendChild(this.#i)}getValue(){return!!this.underlyingElement.checked}down(){this.underlyingElement&&(this.#t.removeChild(this.#i),this.underlyingElement.remove(),this.#i.remove(),this.underlyingElement=null,this.#i=null)}}class InputNappula{underlyingElement;#n;#a;#t;#e;static nro=1;constructor(t,e,i,n){if(!t||!e||!i)throw Error("Konstruktorille pit√§√§ antaa j√§rkev√§t kent√§t.");this.underlyingElement=null,this.#n=t,this.#a=e,this.#t=i,this.#e=n}up(t,e){const i=`<button   id="nappi${InputNappula.nro++}" name="${e}"\n                                class="${this.#e}" type="button">${t}</button>`;this.underlyingElement=htmlToNode(i),this.underlyingElement.addEventListener(this.#a,this.#n),this.#t.appendChild(this.underlyingElement)}down(){this.underlyingElement&&(this.underlyingElement.removeEventListener(this.#a,this.#n),this.#t.removeChild(this.underlyingElement),this.underlyingElement.remove(),this.underlyingElement=null)}click(){this.underlyingElement.classList.add("painettu"),this.underlyingElement.click(),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_KUOLEMA/2),this.underlyingElement?this.underlyingElement.classList.remove("painettu"):Util.logWarn("Alla oleva underlyingElement puuttuu, toivottavasti siksi ett√§ komponentti on jo poistettu.")})()}}class BaseFormi{underlyingElement;onDestructFunction;onConstructFunction;#t;#l=!1;constructor(t){if(!t)throw Error("Konstruktorille pit√§√§ antaa containingElement mihin kiinnitty√§.");this.underlyingElement=null,this.#t=t}_isBeingAnimated(){return this.#l}_attach(t){this._isBeingAnimated()||(document.getElementById("popupit").classList.remove("piilossa"),this.#l=!0,this.underlyingElement=htmlToNode(t),this.#t.appendChild(this.underlyingElement),this.underlyingElement.classList.add("popup"),this.underlyingElement.classList.add("syntynyt"),kytkeNappaimienKuuntelija(!1),kytkeHakukentanKuuntelija(!1),kytkeForminNappaimienKuuntelija(!1),(async()=>{Util.isDebugLog()&&Util.logDebug(`${(new Date).toISOString()}: odotetaan hetki, sitten todetaan animoinnin loppuneen`),await Util.sleep(Cyk.ANIMAATIO_PITUUS_SYNTYMA),this.#l=!1,kytkeForminNappaimienKuuntelija(!0),Util.isDebugLog()&&Util.logDebug(`${(new Date).toISOString()}: animointi on loppunut`),this.onConstructFunction&&this.onConstructFunction()})())}#s(t){if(this._isBeingAnimated())return;this.#l=!0,this.underlyingElement.classList.remove("syntynyt");let e=t?"hyvaksy":"kumoa";this.underlyingElement.classList.add(e),(async()=>{await Util.sleep(Cyk.ANIMAATIO_PITUUS_KUOLEMA),kytkeForminNappaimienKuuntelija(!1),this.onDestructFunction&&this.onDestructFunction(),this.#o()})()}#o(){Util.isDebugLog&&Util.logDebug(`removeInstantly kutsuttiin elementille ${this.underlyingElement} joka oli sis√§ll√§ elementin ${this.#t}`),document.getElementById("popupit").classList.add("piilossa"),this.#l=!1,this.#t.removeChild(this.underlyingElement),this.underlyingElement.remove(),this.underlyingElement=null,kytkeNappaimienKuuntelija(!0),kytkeHakukentanKuuntelija(!0)}isUp(){return!!this.underlyingElement}up(){throw Error("M√§√§rittele minut!")}down(t){this.isUp()&&(this._downSupplement(),this.#s(t))}_downSupplement(t=!1){}}class FormHenkiloa extends BaseFormi{#u;#m;constructor(t,e,i){super(e),this.#u=t,this.#m=i}up(t){if(this.isUp())return;const e=`<form id="${this.#m}" class="ikkuna" action="" onsubmit="return false;">    <label class="forminRivi" id="labelForEtun" required="true">Etunimet:</label>    <label class="forminRivi" id="labelForSukun" required="false">Sukunimet:</label>    <label class="forminRivi" id="labelForSAika" required="false">Syntym√§aika:</label>    <label class="forminRivi" id="labelForKAika" required="false">Kuolinaika:</label>    <label class="forminRivi" id="labelForSPaikka" required="false">Syntym√§paikka:</label>    <label class="forminRivi" id="labelForPAPaikka" required="false">P√§√§asiallinen<br/>paikkakunta:</label>    <label class="forminRivi" id="labelForAidink" required="false">√Ñidinkieli:</label>    <label class="forminRivi" id="labelForHeimo" required="false">Heimo:</label>    <label class="forminRivi" id="labelForLisatieto" required="false">Vapaa lis√§tietokentt√§:</label>    <span class="forminRivi" id="spanForTallennaKumoa" /></form>`;this._attach(e),this.etunimetKentta=new InputKentta(document.getElementById("labelForEtun"),"forminKentta"),this.sukuNimetKentta=new InputKentta(document.getElementById("labelForSukun"),"forminKentta"),this.syntAikaKentta=new InputPvm(document.getElementById("labelForSAika"),"forminKentta"),this.kuolAikaKentta=new InputPvm(document.getElementById("labelForKAika"),"forminKentta"),this.syntPaikkaKentta=new InputKentta(document.getElementById("labelForSPaikka"),"forminKentta"),this.paaAsPaikkaKentta=new InputKentta(document.getElementById("labelForPAPaikka"),"forminKentta"),this.aidinkieliKentta=new InputKentta(document.getElementById("labelForAidink"),"forminKentta"),this.heimoKentta=new InputKentta(document.getElementById("labelForHeimo"),"forminKentta"),this.vapaaTietoKentta=new InputKentta(document.getElementById("labelForLisatieto"),"forminKentta lisatietoKentta"),this.kumoaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.tallennaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.etunimetKentta.up(t.etunimet),this.sukuNimetKentta.up(t.sukunimet),this.syntAikaKentta.up(Util.dateToInputDateString(t.syntAika)),this.kuolAikaKentta.up(Util.dateToInputDateString(t.kuolAika)),this.syntPaikkaKentta.up(t.syntPaikka),this.paaAsPaikkaKentta.up(t.paaAsPaikka),this.aidinkieliKentta.up(t.aidinkieli),this.heimoKentta.up(t.heimo),this.vapaaTietoKentta.up(t.vapaaTieto,!0),this.kumoaNappi.up("Kumoa muutokset ‚ùå",Cyk.POPUP_KUMOA_TUNNISTE),this.tallennaNappi.up("Tallenna henkil√∂ ‚úîÔ∏è",Cyk.POPUP_TALLENNA_TUNNISTE),this.onConstructFunction=()=>{Util.setCursorFocusAtEndOfText(this.etunimetKentta.underlyingElement)}}_downSupplement(t=!1){this._isBeingAnimated()&&!1===t||(this.onDestructFunction=()=>{this.etunimetKentta.down(),this.etunimetKentta=null,document.getElementById("labelForEtun").remove(),this.sukuNimetKentta.down(),this.sukuNimetKentta=null,document.getElementById("labelForSukun").remove(),this.syntAikaKentta.down(),this.syntAikaKentta=null,document.getElementById("labelForSAika").remove(),this.kuolAikaKentta.down(),this.kuolAikaKentta=null,document.getElementById("labelForKAika").remove(),this.syntPaikkaKentta.down(),this.syntPaikkaKentta=null,document.getElementById("labelForSPaikka").remove(),this.paaAsPaikkaKentta.down(),this.paaAsPaikkaKentta=null,document.getElementById("labelForPAPaikka").remove(),this.aidinkieliKentta.down(),this.aidinkieliKentta=null,document.getElementById("labelForAidink").remove(),this.heimoKentta.down(),this.heimoKentta=null,document.getElementById("labelForHeimo").remove(),this.vapaaTietoKentta.down(),this.vapaaTietoKentta=null,document.getElementById("labelForLisatieto").remove(),this.kumoaNappi.down(),this.kumoaNappi=null,this.tallennaNappi.down(),this.tallennaNappi=null,document.getElementById("spanForTallennaKumoa").remove()})}}class FormSuhdetta extends BaseFormi{#u;#m;constructor(t,e,i){super(e),this.#u=t,this.#m=i}up(t){if(this.isUp())return;const e=`<form id="${this.#m}" class="ikkuna" action="" onsubmit="return false;">    <label class="liukujaRivi" id="labelForNimike">Vapaa merkint√§:</label>    <label class="liukujaRivi" id="labelForYhdessa">Yhdess√§:</label>    <label class="liukujaRivi" id="labelForNaimisissa">Naimisissa:</label>    <span class="forminRivi" id="spanForTallennaKumoa" /></form>`;this._attach(e),this.nimikeKentta=new InputKentta(document.getElementById("labelForNimike"),"forminKentta"),this.yhdessaValitsin=new InputValitsin(document.getElementById("labelForYhdessa")),this.naimisissaValitsin=new InputValitsin(document.getElementById("labelForNaimisissa")),this.kumoaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.tallennaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.nimikeKentta.up(t.nimike),this.yhdessaValitsin.up(t.onkoYhdessa),this.naimisissaValitsin.up(t.onkoNaimisissa),this.kumoaNappi.up("Kumoa muutokset ‚ùå",Cyk.POPUP_KUMOA_TUNNISTE),this.tallennaNappi.up("Tallenna suhde ‚úîÔ∏è",Cyk.POPUP_TALLENNA_TUNNISTE),this.onConstructFunction=()=>{Util.setCursorFocusAtEndOfText(this.nimikeKentta.underlyingElement)}}_downSupplement(t=!1){this._isBeingAnimated()&&!1===t||(this.onDestructFunction=()=>{this.nimikeKentta.down(),this.nimikeKentta=null,document.getElementById("labelForNimike").remove(),this.yhdessaValitsin.down(),this.yhdessaValitsin=null,document.getElementById("labelForYhdessa").remove(),this.naimisissaValitsin.down(),this.naimisissaValitsin=null,document.getElementById("labelForNaimisissa").remove(),this.kumoaNappi.down(),this.kumoaNappi=null,this.tallennaNappi.down(),this.tallennaNappi=null,document.getElementById("spanForTallennaKumoa").remove()})}}class FormAsetukset extends BaseFormi{#u;constructor(t,e){super(e),this.#u=t}up(t){if(this.isUp())return;this._attach('<form class="ikkuna" action="" onsubmit="return false;">    <label class="liukujaRivi" id="labelForLaajatTiedot">N√§yt√§ aina laajat tiedot:</label>    <label class="liukujaRivi" id="labelForOffline">Offline-tila:</label>    <label class="liukujaRivi" id="labelForStatusbarDebug">N√§yt√§ debug-tiedot statusbarissa</label>    <span class="forminRivi" id="spanForTallennaKumoa" /></form>'),this.naytaLaajatTiedotValitsin=new InputValitsin(document.getElementById("labelForLaajatTiedot")),this.offlineMoodiValitsin=new InputValitsin(document.getElementById("labelForOffline")),this.statusbarDebugValitsin=new InputValitsin(document.getElementById("labelForStatusbarDebug")),this.kumoaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.tallennaNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.naytaLaajatTiedotValitsin.up(t.naytaLaajatTiedot(),!0),this.offlineMoodiValitsin.up(t.offlineMoodi()),this.statusbarDebugValitsin.up(t.statusbarinDebugtieto()),this.kumoaNappi.up("Kumoa muutokset ‚ùå",Cyk.POPUP_KUMOA_TUNNISTE),this.tallennaNappi.up("Tallenna asetukset ‚úîÔ∏è",Cyk.POPUP_TALLENNA_TUNNISTE)}_downSupplement(t=!1){this._isBeingAnimated()&&!1===t||(this.onDestructFunction=()=>{this.naytaLaajatTiedotValitsin.down(),this.naytaLaajatTiedotValitsin=null,document.getElementById("labelForLaajatTiedot").remove(),this.offlineMoodiValitsin.down(),this.offlineMoodiValitsin=null,document.getElementById("labelForOffline").remove(),this.statusbarDebugValitsin.down(),this.statusbarDebugValitsin=null,document.getElementById("labelForStatusbarDebug").remove(),this.kumoaNappi.down(),this.kumoaNappi=null,this.tallennaNappi.down(),this.tallennaNappi=null,document.getElementById("spanForTallennaKumoa").remove()})}}class FormPikanappaimet extends BaseFormi{#u;constructor(t,e){super(e),this.#u=t}up(){if(this.isUp())return;this._attach('<form id="pikanappaimet" class="ikkuna" action="" onsubmit="return false;">  <h2>‚å®Ô∏è Pikan√§pp√§imet</h2>  <div class="k√§√§re"><div><em>Shift</em> + <em>F1</em> tai <em>H</em>elp </div><div>t√§m√§ helppi</div></div>  <div class="k√§√§re"><div><em>A</em>ll </div><div>valitse kaikki</div></div>  <div class="k√§√§re"><div><em>N</em>one </div><div>√§l√§ valitse mit√§√§n </div></div>  <div class="k√§√§re"><div><em>M</em>odify </div><div>muokkaa tietoja </div></div>  <div class="k√§√§re"><div><em>L</em>oad </div><div>lataa tiedosto </div></div>  <div class="k√§√§re"><div>sa<em>V</em>e </div><div>tallenna tiedosto </div></div>  <div class="k√§√§re"><div><em>S</em>ettings </div><div>asetukset </div></div>  <div class="k√§√§re"><div><em>P</em>an </div><div>resetoi panorointi </div></div>  <div class="k√§√§re"><div><em>Ctrl</em> + <em>Alt</em> + <em>P</em> </div><div>tallenna panorointi </div></div>  <div class="k√§√§re"><div><em>R</em>elationship </div><div>n√§yt√§ sukulaisuus </div></div>  <div class="k√§√§re"><div><em>I</em>nfo </div><div>vaihtele tietojen n√§ytt√§mist√§ </div></div>  <div class="k√§√§re"><div><em>Esc</em> </div><div>peruminen yleisesti</div></div>  <div class="k√§√§re"><div><em>Enter</em> </div><div>hyv√§ksyminen yleisesti</div></div>  <div class="k√§√§re"><div><em>Nuolin√§pp√§imet</em> </div><div>vaihda valittua solmua </div></div>  <div class="k√§√§re"><div><em>Shift</em> + <em>Nuolin√§p.</em> </div><div>liikuta ruutua </div></div>  <div class="k√§√§re"><div><em>Ctrl</em> + <em>Nuolin√§p.</em> </div><div>liikuta valittua solmua </div></div>  <div class="k√§√§re"><div><em>Ctrl</em> + <em>Shift</em> + <em>Yl√∂s</em> </div><div>luo suhde/henkil√∂ yl√§puolelle </div></div>  <div class="k√§√§re"><div><em>Ctrl</em> + <em>Shift</em> + <em>Alas</em> </div><div>luo suhde/henkil√∂ alapuolelle </div></div>  <label class="k√§√§re" id="spanForTallennaKumoa"></form>'),this.okNappi=new InputNappula(this.#u,"click",document.getElementById("spanForTallennaKumoa"),"forminNappi"),this.okNappi.up(Math.random()>.5?"Selkis! üÜó":"Asia selv√§! ü´°",""),document.createElement("button").setAttribute("autofocus","")}_downSupplement(t=!1){this._isBeingAnimated()&&!1===t||(this.onDestructFunction=()=>{this.okNappi.down(),this.okNappi=null,document.getElementById("spanForTallennaKumoa").remove()})}}export{FormHenkiloa,FormSuhdetta,FormAsetukset,FormPikanappaimet};