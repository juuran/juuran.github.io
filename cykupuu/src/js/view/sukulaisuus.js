import{asetukset,cykupuu,tila}from"../controller/main.js";import{cy}from"../controller/cykupuu.js";import{Henkilo}from"../model/henkilo.js";import{Suhde}from"../model/suhde.js";import{laskeLahinGridPiste}from"./piirtoalgoritmit.js";class Sukulaisuus{henkilotMap;suhteetMap;#s;constructor(s,i){this.henkilotMap=s,this.suhteetMap=i}piirraSukulaisuusNimike(s,i=null){return"nollaa"===s?this.palautaNormaalitNimet():"piirrä"===s&&(this.#s=i,this.naiiviSukulaisuusAlgoritmi(i)),this.#s}palautaNormaalitNimet(){const s=cy.nodes();for(const i of s){const s=i.scratch()._itse.henkilo;s&&(i.toggleClass("sukulais-itse",!1),i.toggleClass("sukulaisuus",!1),i.json({data:{label:`${s.getNakyvaNimi()}`}}))}}asetaSukulaisNimike(s,i,t=!1){const o=cy.getElementById(s.id);t&&o.toggleClass("sukulais-itse",!0),o.toggleClass("sukulaisuus",!0),o.json({data:{label:`${s.getNakyvaNimi()}\n\n${i}`}})}etsiPuolisot(s,i,t,o,a){const e=[];for(const n of s.pariSuhteet){const u=this.suhteetMap.get(n.getSuhdeId());for(const n of u.ylavirtaLiitokset){const l=this.henkilotMap.get(n.getHenkiloId());l!==s&&(e.push(l),u.onkoYhdessa?this.asetaSukulaisNimike(l,u.onkoNaimisissa?i:t):this.asetaSukulaisNimike(l,u.onkoNaimisissa?o:a))}}return e}etsiSukupolvi(s,i){const t=[];if("alas"===s)for(const s of i.pariSuhteet){const i=this.suhteetMap.get(s.getSuhdeId());for(const s of i.alavirtaLiitokset)t.push(this.henkilotMap.get(s.getHenkiloId()))}else if("ylös"===s)for(const s of i.vanhempiSuhteet){const i=this.suhteetMap.get(s.getSuhdeId());for(const s of i.ylavirtaLiitokset)t.push(this.henkilotMap.get(s.getHenkiloId()))}return t}naiiviSukulaisuusAlgoritmi(s){this.asetaSukulaisNimike(s,"itse",!0);const i=this.etsiSukupolvi("alas",s);for(const s of i){this.asetaSukulaisNimike(s,"lapsi");const i=this.etsiSukupolvi("alas",s);for(const s of i){this.asetaSukulaisNimike(s,"lapsen-\nlapsi");const i=this.etsiSukupolvi("alas",s);for(const s of i){this.asetaSukulaisNimike(s,"lapsen-\nlapsen-\nlapsi");const i=this.etsiSukupolvi("alas",s);for(const s of i){this.asetaSukulaisNimike(s,"3 × lapsen-\nlapsi");const i=this.etsiSukupolvi("alas",s);for(const s of i)this.asetaSukulaisNimike(s,"4 × lapsen-\nlapsi")}}}const t=this.etsiPuolisot(s,"vävy / miniä","lapsen puoliso","ex-\nvävy / -miniä","lapsen ex-\npuoliso");for(const s of t){const i=this.etsiSukupolvi("ylös",s);for(const t of i){this.asetaSukulaisNimike(t,"vävyn /\nminiän\nvanhempi");const i=this.etsiSukupolvi("alas",t);for(const t of i)t!==s&&this.asetaSukulaisNimike(t,"vävyn /\nminiän\nsisarus")}}}const t=this.etsiSukupolvi("ylös",s);for(const i of t){this.asetaSukulaisNimike(i,"vanhempi");const t=this.etsiSukupolvi("ylös",i);for(const o of t){this.asetaSukulaisNimike(o,"isovanhempi");const t=this.etsiSukupolvi("ylös",o);for(const s of t){this.asetaSukulaisNimike(s,"iso-\niso-\nvanhempi");const t=this.etsiSukupolvi("ylös",s);for(const s of t){this.asetaSukulaisNimike(s,"3 × iso-\nvanhempi");const i=this.etsiSukupolvi("ylös",s);for(const s of i)this.asetaSukulaisNimike(s,"4 × iso-\nvanhempi")}const a=this.etsiSukupolvi("alas",s);for(const s of a){if(s===o)continue;this.asetaSukulaisNimike(s,"isosetä /\nisotäti /\nisoeno");const t=this.etsiSukupolvi("alas",s);for(const s of t){if(s===i)continue;this.asetaSukulaisNimike(s,"isosetän /\nisotädin /\nisoenon\nlapsi");const t=this.etsiSukupolvi("alas",s);for(const s of t)this.asetaSukulaisNimike(s,"pikku-\nserkku")}}}const a=this.etsiSukupolvi("alas",o);for(const t of a){if(t===i)continue;this.asetaSukulaisNimike(t,"setä /\ntäti /\neno");const o=this.etsiSukupolvi("alas",t);for(const i of o){if(i===s)continue;this.asetaSukulaisNimike(i,"serkku");const t=this.etsiSukupolvi("alas",i);for(const s of t)this.asetaSukulaisNimike(s,"serkun\nlapsi")}}}const o=this.etsiSukupolvi("alas",i);for(const i of o){if(i===s)continue;this.asetaSukulaisNimike(i,"sisarus");const t=this.etsiSukupolvi("alas",i);for(const s of t){this.asetaSukulaisNimike(s,"sisar(uks)en-\nlapsi");const i=this.etsiSukupolvi("alas",s);for(const s of i)this.asetaSukulaisNimike(s,"sisaruksen-\nlapsen-\nlapsi")}this.etsiPuolisot(i,"lanko /\nkäly","sisaruksen\npuoliso","ex-lanko /\n-käly","sisaruksen\nex-puoliso")}}const o=this.etsiPuolisot(s,"aviopuoliso","puoliso","ex-avio\npuoliso","ex-\npuoliso");for(const s of o){const i=this.etsiSukupolvi("ylös",s);for(const t of i){this.asetaSukulaisNimike(t,"a(no)ppi");const i=this.etsiSukupolvi("alas",t);for(const t of i)t!==s&&(this.asetaSukulaisNimike(t,"käly /\nlanko"),this.etsiPuolisot(t,"käly / lanko","kälyn /\nlangon\npuoliso","ex-käly / ex-lanko","kälyn /\nlangon\nex-puoliso"))}}}}export{Sukulaisuus};